---
- hosts: coreservers
  tasks:
  # Install JDK
    - name: Install jdk 1.8
      package:
        name: openjdk-8-jre-headless
        state: present
      become: true
      become_user: root

    - name: Check Java version
      command: java -version
      register: java_version
      # Use the changed_when parameter so that this task doesn't appear as a changed status
      changed_when: false

    - name: Display java version
      debug:
        # Return just the first line of java -version
        msg: "{{ java_version.stderr_lines[0] }}"

# Install TOMCAT
    - name: Install Tomcat 8 + Admin
      package:
        name: "{{Â item }}"
        state: present
      with_items:
        - tomcat8
        - tomcat8-admin
      become: true
      become_user: root

    - name: Configure Tomcat Users
      template:
        src: "{{ ansible_home_dir }}/roles/tomcat/templates/tomcat-users.xml.j2"
        dest: "{{ tomcat_config_dir }}/tomcat-users.xml"
        group: tomcat8
        mode: preserve
      become: true
      become_user: root

    - name: Restart tomcat
      service: state=restarted name={{ tomcat_service_name }}
      become: true
      become_user: root
      tags: tomcat
